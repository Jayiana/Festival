@page "/edit/lineup/{festivalId:int}/{artistId:int}"
@using ShowTime_BusinessLogic.Abstractions
@using ShowTime_BusinessLogic.Dtos
@inject ILineupService LineupService
@inject NavigationManager NavManager
@rendermode InteractiveServer

<div class="edit-page festival-edit-bg">
    <div class="festival-decoration">
        <div class="sparkle"></div>
        <div class="music-note">🎸</div>
        <div class="star">★</div>
        <div class="heart">💜</div>
        <div class="triangle"></div>
        <div class="circle"></div>
    </div>
    <div class="edit-form-container">
        <div class="image-preview">
            <p>Editing Lineup for Festival ID @festivalId and Artist ID @artistId</p>
        </div>
        <div class="edit-form-section">
            <div class="form-header">
                <h2><span class="icon">🎸</span> Edit Lineup <span class="icon">🎶</span></h2>
            </div>
            <EditForm Model="@lineup" OnValidSubmit="SubmitLineup" FormName="EditLineupForm">
                <DataAnnotationsValidator />
                <ValidationSummary />
                <label><span class="label-icon">🎤</span> Stage:</label>
                <InputText @bind-Value="lineup.Stage" class="form-control" />
                <label><span class="label-icon">⏰</span> Start Time:</label>
                <InputDate @bind-Value="lineup.StartTime" class="form-control" />
                <label><span class="label-icon">🔥</span> Is Main Stage:</label>
                <InputCheckbox @bind-Value="lineup.IsMainStage" />
                <label><span class="label-icon">🎸</span> Is Live Performance:</label>
                <InputCheckbox @bind-Value="lineup.IsLivePerformance" />
                <label><span class="label-icon">📝</span> Description:</label>
                <InputTextArea @bind-Value="lineup.Description" class="form-control" rows="4" />
                <label><span class="label-icon">🎨</span> Stage Theme:</label>
                <InputText @bind-Value="lineup.StageTheme" class="form-control" />
                <div class="form-tags">
                    <span class="tag">🎸 Lineup</span>
                    <span class="tag">🎶 Performance</span>
                </div>
                <button type="submit" class="btn-submit festival-btn">Save Changes</button>
            </EditForm>
        </div>
    </div>
    <div class="bottom-decoration">
        <span>🎵</span><span>🎤</span><span>🎸</span>
    </div>
</div>

@code {
    [Parameter] public int festivalId { get; set; }
    [Parameter] public int artistId { get; set; }
    private LineupUpdateDto lineup = new();

    protected override async Task OnInitializedAsync()
    {
        var existing = await LineupService.GetAsync(festivalId, artistId);
        lineup.Stage = existing.Stage;
        lineup.StartTime = existing.StartTime;
        lineup.IsMainStage = existing.IsMainStage;
        lineup.IsLivePerformance = existing.IsLivePerformance;
        lineup.Description = existing.Description;
        lineup.StageTheme = existing.StageTheme;
    }

    private async Task SubmitLineup()
    {
        await LineupService.UpdateAsync(festivalId, artistId, lineup);
        NavManager.NavigateTo("/lineups");
    }
}
